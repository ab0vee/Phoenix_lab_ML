# üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Phoenix LAB

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
database/
‚îú‚îÄ‚îÄ schema.sql              # –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å –Ω—É–ª—è)
‚îú‚îÄ‚îÄ migrations/             # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îÇ   ‚îî‚îÄ‚îÄ 001_initial_schema.sql
‚îú‚îÄ‚îÄ models.py              # SQLAlchemy –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ setup_db.sql           # –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ë–î —Å –Ω—É–ª—è (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ë–î)

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
createdb phoenix_lab

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å—Ö–µ–º—É
psql -d phoenix_lab -f schema.sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker:
docker exec -i phoenix_postgres psql -U phoenix_user -d phoenix_lab < schema.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–π –ë–î (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

–°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ `INTEGRATION.md`

## üìã –¢–∞–±–ª–∏—Ü—ã

### `users`
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö:
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `username` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ)
- `email` - email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `password_hash` - —Ö–µ—à –ø–∞—Ä–æ–ª—è
- `is_active` - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `is_admin` - —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

### `user_urls`
–°—Å—ã–ª–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `url` - URL —Å—Å—ã–ª–∫–∏
- `title` - –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `status` - —Å—Ç–∞—Ç—É—Å (active, archived, deleted)
- `metadata` - JSON —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### `url_processing_results`
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Å—ã–ª–æ–∫:
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `url_id` - —Å—Å—ã–ª–∫–∞ –Ω–∞ user_urls
- `original_text` - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
- `summarized_text` - —Å—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- `paraphrased_text` - –ø–∞—Ä–∞—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- `language` - —è–∑—ã–∫ (ru, en)

### `user_sessions`
–°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏):
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `session_token` - —Ç–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏
- `expires_at` - –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è

## üîß –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

### –ß–µ—Ä–µ–∑ psql
```bash
psql -h localhost -U phoenix_user -d phoenix_lab
```

### –ß–µ—Ä–µ–∑ Docker
```bash
docker exec -it phoenix_postgres psql -U phoenix_user -d phoenix_lab
```

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã –ë–î.

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `migrations/002_description.sql`
2. –î–æ–±–∞–≤—å—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ `migrations/version.txt`

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
for file in migrations/*.sql; do
    psql -d phoenix_lab -f "$file"
done
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ü–∞—Ä–æ–ª–∏**: –•—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ö–µ—à–∏ (bcrypt, argon2)
- **–ò–Ω–¥–µ–∫—Å—ã**: –°–æ–∑–¥–∞–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **CASCADE**: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Å—Å—ã–ª–∫–∏
- **UNIQUE**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üìä –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
SELECT u.url, u.title, u.created_at 
FROM user_urls u 
WHERE u.user_id = 1 AND u.status = 'active'
ORDER BY u.created_at DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
```sql
SELECT 
    u.url,
    r.summarized_text,
    r.paraphrased_text,
    r.processing_time
FROM url_processing_results r
JOIN user_urls u ON r.url_id = u.id
WHERE u.user_id = 1
ORDER BY r.created_at DESC;
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
```sql
\d users
\d user_urls
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
```sql
\dt
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
```sql
\di
```

