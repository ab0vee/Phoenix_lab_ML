# Frontend - Подробная документация

## Содержание

1. [Обзор](#обзор)
2. [Технологии](#технологии)
3. [Архитектура](#архитектура)
4. [Компоненты](#компоненты)
5. [Функционал](#функционал)
6. [Состояние и управление данными](#состояние-и-управление-данными)

---

## Обзор

Frontend Phoenix LAB построен на Next.js 14 с использованием React 18 и TypeScript. Это современное SPA приложение с SSR возможностями для быстрой загрузки и SEO оптимизации.

**Основные возможности:**
- Интерфейс для рерайта и суммаризации текстов
- Управление пользователями и URL
- Система монетизации с тарифными планами
- Интеграция с Telegram ботом
- Настройки и конфигурация

---

## Технологии

### Next.js 14

**Почему Next.js:**
- ✅ **App Router** - современный подход к роутингу
- ✅ **SSR** - Server-Side Rendering для быстрой загрузки
- ✅ **Оптимизация** - автоматическая оптимизация кода и изображений
- ✅ **TypeScript** - встроенная поддержка
- ✅ **Production Ready** - готовность к продакшену из коробки

**Особенности использования:**
- Используется App Router (папка `app/`)
- Client Components с директивой `'use client'`
- Server Components по умолчанию (где возможно)

---

### React 18

**Функции:**
- Hooks (useState, useEffect, useRef)
- Context API (для темы и настроек)
- Event Listeners (для кастомных событий)

**Особенности:**
- Все компоненты функциональные
- Используются хуки для управления состоянием
- Оптимизация рендеринга через мемоизацию (где нужно)

---

### TypeScript

**Использование:**
- Строгая типизация всех компонентов
- Интерфейсы для пропсов и состояний
- Типы для API ответов

**Преимущества:**
- Меньше ошибок в рантайме
- Автодополнение в IDE
- Лучшая читаемость кода

---

## Архитектура

### Структура проекта

```
frontend/
├── app/
│   ├── components/        # React компоненты
│   │   ├── AuthMenu.tsx
│   │   ├── DatabaseMenu.tsx
│   │   ├── SettingsMenu.tsx
│   │   ├── MonetizationMenu.tsx
│   │   └── ...
│   ├── page.tsx          # Главная страница
│   ├── layout.tsx        # Root layout
│   └── globals.css       # Глобальные стили
├── public/               # Статические файлы
│   ├── logo.png
│   ├── piar.png
│   └── assets/
└── package.json
```

---

### Компонентная структура

**Главная страница (`page.tsx`):**
- Центральный компонент приложения
- Управление состоянием всего приложения
- Обработка всех пользовательских действий

**Меню компоненты:**
- `AuthMenu` - авторизация через Telegram
- `DatabaseMenu` - работа с базой данных (URL, пользователи)
- `SettingsMenu` - настройки моделей и стилей
- `MonetizationMenu` - тарифные планы и монетизация

**UI компоненты:**
- `IconButton` - кнопки с иконками
- `FallingElements` - анимация падающих элементов

---

## Компоненты

### Главная страница (page.tsx)

**Назначение:**
- Центральный компонент всего приложения
- Управление всеми состояниями
- Обработка всех API запросов

**Основные состояния:**
```typescript
const [url, setUrl] = useState('')
const [resultText, setResultText] = useState('')
const [loading, setLoading] = useState(false)
const [selectedStyle, setSelectedStyle] = useState<string | null>(null)
const [user, setUser] = useState<any>(null)
const [showAuthMenu, setShowAuthMenu] = useState(false)
const [showSettingsMenu, setShowSettingsMenu] = useState(false)
const [showDatabaseMenu, setShowDatabaseMenu] = useState(false)
const [showMonetizationMenu, setShowMonetizationMenu] = useState(false)
```

**Основные функции:**
- `handleRewriteSubmit()` - обработка рерайта
- `handleSummarizeSubmit()` - обработка суммаризации
- `loadChannels()` - загрузка списка каналов
- `handleSendToTelegram()` - отправка в Telegram

---

### AuthMenu

**Назначение:**
- Авторизация пользователей через Telegram WebApp
- Проверка токена авторизации
- Сохранение данных пользователя

**Функционал:**
- Интеграция с Telegram WebApp SDK
- Генерация и проверка токенов
- Сохранение пользователя в localStorage

---

### DatabaseMenu

**Назначение:**
- Отображение всех пользователей и их URL
- Просмотр результатов обработки
- Вставка URL в поле ввода

**Функционал:**
- Загрузка данных через `/api/data`
- Отображение в табличном формате
- Вставка URL через кастомное событие `insertUrl`

---

### SettingsMenu

**Назначение:**
- Выбор модели для рерайта/суммаризации
- Выбор стиля рерайта
- Проверка доступа к моделям по тарифу

**Функционал:**
- Фильтрация моделей по тарифу
- Блокировка недоступных моделей
- Отображение информации о моделях

**Модели:**
- **NLP модели** (бесплатные): RUT5, FLAN-T5, Gazeta
- **LLM модели** (платные): Qwen, YandexGPT

---

### MonetizationMenu

**Назначение:**
- Выбор тарифного плана
- Настройка индивидуальных функций (Custom план)
- Управление доступом к функциям

**Тарифные планы:**

1. **Пользовательский**
   - Доступ: только NLP модели
   - Бесплатно

2. **Бизнес**
   - Доступ: все LLM модели
   - Платно

3. **Настраиваемый**
   - Доступ: индивидуальный выбор функций
   - Платно по функциям

**Функционал:**
- Сохранение выбранного тарифа в localStorage
- Сохранение выбранных функций (Custom план)
- Проверка доступа к моделям

---

## Функционал

### Рерайт текста

**Процесс:**
1. Пользователь вводит URL или текст
2. Выбирает стиль (scientific, casual, meme)
3. Выбирает провайдера (RUT5, FLAN-T5, Qwen, YandexGPT)
4. Нажимает "Рерайт"
5. Запрос отправляется в `/api/rewrite-article`
6. Результат отображается в интерфейсе

**Особенности:**
- Автоматическое определение URL или текста
- Проверка доступа к выбранной модели
- Предупреждение для NLP моделей при вводе URL
- Отображение изображений (если есть)

---

### Суммаризация текста

**Процесс:**
1. Пользователь вводит URL или текст
2. Выбирает провайдера (Gazeta, Qwen, YandexGPT)
3. Нажимает "Сократить"
4. Запрос отправляется в `/api/summarize-article`
5. Результат отображается в интерфейсе

**Особенности:**
- Разные сообщения для NLP и LLM моделей
- Автоматическое добавление источника в конец текста

---

### Публикация в Telegram

**Процесс:**
1. После обработки текста появляется кнопка "Опубликовать"
2. Пользователь выбирает каналы
3. Нажимает "Отправить"
4. Запрос отправляется в `/api/send-article`
5. Отображается результат отправки

**Требования:**
- Пользователь должен быть авторизован
- Каналы должны быть добавлены через бота
- Бот должен быть администратором каналов

---

### Динамическое изменение размера textarea

**Особенность:**
- Поле ввода автоматически увеличивается по вертикали
- Высота подстраивается под размер текста
- Текст всегда виден полностью

**Реализация:**
```typescript
const textareaRef = useRef<HTMLTextAreaElement>(null)

useEffect(() => {
  if (textareaRef.current) {
    textareaRef.current.style.height = 'auto'
    textareaRef.current.style.height = textareaRef.current.scrollHeight + 'px'
  }
}, [url])
```

---

### Темная тема

**Функционал:**
- Переключение между светлой и темной темой
- Сохранение выбора в localStorage
- Применение к `document.body`

---

## Состояние и управление данными

### LocalStorage

**Хранение:**
- `theme` - выбранная тема (light/dark)
- `telegram_user` - данные пользователя Telegram
- `user_tariff` - выбранный тарифный план
- `custom_features` - выбранные функции (для Custom плана)

---

### API интеграция

**Endpoints:**
- `POST /api/rewrite-article` - рерайт статьи
- `POST /api/summarize-article` - суммаризация статьи
- `POST /api/send-article` - отправка в Telegram
- `GET /api/channels` - список каналов
- `GET /api/data` - все данные из БД
- `POST /api/auth/verify-token` - проверка токена
- `GET /api/users/<username>/urls` - URL пользователя

---

### Кастомные события

**insertUrl:**
- Событие для вставки URL из DatabaseMenu
- Отправляется через `window.dispatchEvent()`
- Обрабатывается в главном компоненте

---

## Особенности реализации

### Проверка доступа к моделям

**Функция `checkModelAccess()`:**
- Проверяет выбранный тариф
- Проверяет наличие функции в Custom плане
- Возвращает доступность модели

**NLP модели:**
- Всегда доступны (бесплатные)

**LLM модели:**
- Доступны только при наличии доступа в тарифе

---

### Управление изображениями

**Типы изображений:**
- `original` - оригинальное изображение из статьи
- `pexels` - изображение из Pexels
- `generated` - сгенерированное изображение (Kandinsky)

**Состояния загрузки:**
- Отдельные состояния для каждого типа
- Индикаторы загрузки
- Обработка ошибок

---

### Обработка ошибок

**Типы ошибок:**
- Ошибки API запросов
- Ошибки валидации
- Ошибки доступа к функциям

**Обработка:**
- Отображение сообщений об ошибках
- Логирование в консоль
- Fallback значения

---

## Заключение

Frontend Phoenix LAB предоставляет полнофункциональный интерфейс для работы с системой обработки текстов. Современный стек (Next.js, React, TypeScript) обеспечивает производительность, типизацию и удобство разработки.

Все компоненты модульные и переиспользуемые, что упрощает поддержку и расширение функционала.

